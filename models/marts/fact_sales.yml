version: 2

models:
  - name: fact_sales
    description: "Tabela fato de vendas no nível de linha de pedido (order detail). Contém métricas de vendas e chaves para dimensões relacionadas, incluindo razão da venda."
    columns:
      - name: sales_order_detail_sk
        description: "Chave surrogate da fato (detalhe da linha do pedido)."
        tests:
          - not_null
          - unique

      - name: sales_order_id
        description: "Identificador do pedido de venda no sistema transacional."

      - name: customer_sk
        description: "sk para dim_customers."
        tests:
          - relationships:
              to: ref('dim_customers')
              field: customer_pk

      - name: product_sk
        description: "sk para dim_products."
        tests:
          - relationships:
              to: ref('dim_products')
              field: product_pk

      - name: address_sk
        description: "sk para dim_address (endereço)."
        tests:
          - relationships:
              to: ref('dim_address')
              field: address_pk

      - name: creditcard_sk
        description: "sk para dim_creditcard."
        tests:
          - relationships:
              to: ref('dim_creditcard')
              field: creditcard_pk

      - name: shipmethod_sk
        description: "sk para dim_shipmethod."
        tests:
          - relationships:
              to: ref('dim_shipmethod')
              field: shipmethod_pk

      - name: sales_reason_sk
        description: "sk para dim_salesreason. Se não informado, aponta para a linha '-1' (Not informed)."
        tests:
          - relationships:
              to: ref('dim_salesreason')
              field: sales_order_id

      - name: order_date_key
        description: "Chave surrogate para dim_date (data do pedido)."
        tests:
          - not_null
          - relationships:
              to: ref('dim_date')
              field: date_key

      - name: status_order
        description: "Código de status do pedido no ERP."

      - name: order_status_description
        description: "Descrição legível do status do pedido."

      - name: order_qty
        description: "Quantidade de itens no detalhe do pedido."

      - name: unit_price
        description: "Preço unitário do produto."

      - name: gross_amount
        description: "Valor bruto (unit_price * order_qty)."

      - name: net_amount
        description: "Valor líquido (considerando descontos)."

      - name: discount_amount
        description: "Valor total de desconto aplicado no detalhe do pedido."

      - name: subtotal_amount
        description: "Subtotal do pedido."

      - name: tax_amount
        description: "Valor de impostos do pedido."

      - name: freight_amount
        description: "Valor de frete do pedido."

      - name: total_due
        description: "Valor total devido do pedido (subtotal + impostos + frete - descontos)."
